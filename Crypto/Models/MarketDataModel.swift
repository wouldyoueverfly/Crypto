//
//  MarketDataModel.swift
//  Crypto
//
//  Created by dofxmine on 19.05.2025.
//

import Foundation

// JSON Data:
/*
 
 URL: https://api.coingecko.com/api/v3/global
 
 JSON Response:
 
 {
 "data":
 {"active_cryptocurrencies":17105,
 "upcoming_icos":0,
 "ongoing_icos":49,
 "ended_icos":3376,
 "markets":1273,
 "total_market_cap":{"btc":32610712.60202084,"eth":1382829703.3438656,"ltc":34996309234.667564,"bch":8858628460.969595,"bnb":5317065132.907271,"eos":4447975991313.111,"xrp":1458361554772.9229,"xlm":12090610006589.342,"link":220771116997.91388,"dot":749839259223.9865,"yfi":619353379.6973798,"usd":3432097829073.932,"aed":12605992363253.686,"ars":3.890300265966612e+15,"aud":5315025636353.96,"bdt":417036492987927.6,"bhd":1293911177854.3604,"bmd":3432097829073.932,"brl":19372819405990.727,"cad":4787759311068.993,"chf":2864885317156.372,"clp":3226137638351207.5,"cny":24759153738939.363,"czk":75996942229184.12,"dkk":22787499338582.11,"eur":3054968623321.803,"gbp":2570195101258.597,"gel":9403948051662.578,"hkd":26842080183013.016,"huf":1.226921776377581e+15,"idr":5.646710434751325e+16,"ils":12153573227425.16,"inr":293161631598760.06,"jpy":497687362172841.56,"krw":4.770189187319331e+15,"kwd":1054673366580.9327,"lkr":1029397932661859.2,"mmk":7.200541245397113e+15,"mxn":66501013955702.36,"myr":14727131784556.252,"ngn":5.503746399681248e+15,"nok":35357313958619.53,"nzd":5792910938074.217,"php":191435552710085.9,"pkr":969850712710230.2,"pln":12969952609635.66,"rub":276214169333543.2,"sar":12873366512529.863,"sek":33252065150265.566,"sgd":4443828787617.494,"thb":113667648001099.62,"try":133318467331245.33,"twd":103524079435173.78,"uah":142849983027116.78,"vef":343655955625.1729,"vnd":8.905288168429878e+16,"zar":62029563644756.48,"xdr":2503145638069.8086,"xag":105863915562.24275,"xau":1061616500.4891493,"bits":32610712602020.84,"sats":3.261071260202084e+15},"total_volume":{"btc":1483346.3317870654,"eth":62900047.38547811,"ltc":1591858711.0578208,"bch":402947773.4083447,"bnb":241854545.0700196,"eos":202322744403.39514,"xrp":66335724983.7479,"xlm":549959218040.237,"link":10042099679.32731,"dot":34107543989.4222,"yfi":28172201.419391807,"usd":156114028761.69244,"aed":573402144220.8337,"ars":176956042006706.06,"aud":241761775563.01846,"bdt":18969519606776.402,"bhd":58855457185.24436,"bmd":156114028761.69244,"brl":881201246748.2496,"cad":217778289552.4173,"chf":130313531570.3339,"clp":146745625895703.38,"cny":1126206603486.85,"czk":3456832938870.158,"dkk":1036522996813.9766,"eur":138959750939.27148,"gbp":116909112718.76869,"gel":427752438807.03754,"hkd":1220951583086.206,"huf":55808345514859.28,"idr":2.56848947530606e+15,"ils":552823192949.4674,"inr":13334888941549.352,"jpy":22638043273243.816,"krw":216979086574819.94,"kwd":47973372696.38183,"lkr":46823682327890.445,"mmk":327527232342030.94,"mxn":3024896644092.3066,"myr":669885297416.4227,"ngn":250346017662537.6,"nok":1608279543057.6333,"nzd":263499092927.7966,"php":8707728296269.687,"pkr":44115089254156.36,"pln":589957412514.8962,"rub":12564008639392.098,"sar":585564051517.4846,"sek":1512519197815.2107,"sgd":202134102730.2081,"thb":5170340518558.495,"try":6064187001636.441,"twd":4708945350439.284,"uah":6497742042778.523,"vef":15631697699.908268,"vnd":4.050701589798633e+15,"zar":2821506135658.6245,"xdr":113859269052.88026,"xag":4815376245.661596,"xau":48289191.37656674,"bits":1483346331787.0654,"sats":148334633178706.53},
 "market_cap_percentage":{"btc":60.916454793352095,"eth":8.718804602884122,"usdt":4.412854366037157,"xrp":4.017654725584241,"bnb":2.743635995294998,"sol":2.4895673680028865,"usdc":1.7655982109999153,"doge":0.9648945939080484,"ada":0.7741719455241068,"trx":0.7326662389673603},
 "market_cap_change_percentage_24h_usd":-3.361537616294677,
 "updated_at":1747673853}}
 
 */

struct GlobalData: Codable {
    let data: MarketDataModel?
}

struct MarketDataModel: Codable {
    let totalMarketCap, totalVolume, marketCapPercentage: [String: Double]
    let marketCapChangePercentage24hUsd: Double
    
    enum CodingKeys: String, CodingKey {
        case totalMarketCap = "total_market_cap"
        case totalVolume = "total_volume"
        case marketCapPercentage = "market_cap_percentage"
        case marketCapChangePercentage24hUsd = "market_cap_change_percentage_24h_usd"
    }
    
    var marketCap: String {
        if let item = totalMarketCap.first(where: { $0.key == "usd" }) {
            return "$" + item.value.formattedWithAbbreviations()
        }
        return ""
    }
    var volume: String {
        if let item = totalVolume.first(where: { $0.key == "usd" }) {
            return "$" + item.value.formattedWithAbbreviations()
        }
        return ""
    }
    var btcDominance: String {
        if let item = marketCapPercentage.first(where: { $0.key == "btc" }) {
            return item.value.asPercentString()
        }
        return ""
    }
}
